<?xml version="1.0" encoding="ISO-8859-1" ?>

<!DOCTYPE struts-config PUBLIC
          "-//Apache Software Foundation//DTD Struts Configuration 1.1//EN"
          "http://jakarta.apache.org/struts/dtds/struts-config_1_1.dtd">

<!--
     This is the Struts configuration file for the example application,
     using the proposed new syntax.
-->

<struts-config>

  <!-- ========== Form Bean Definitions =================================== -->

  <form-beans>

    <!-- QueryBuild form bean -->
    <form-bean      name="queryBuildForm"
                    type="org.flymine.web.QueryBuildForm"/>

    <!-- FQL Query form bean -->
    <form-bean      name="fqlQueryForm"
                    type="org.flymine.web.FqlQueryForm"/>

    <!-- QueryClassSelect form bean -->
    <form-bean      name="queryClassSelectForm"
                    type="org.flymine.web.QueryClassSelectForm"/>

    <!-- QueryAliasSelect form bean -->
    <form-bean      name="queryAliasSelectForm"
                    type="org.flymine.web.QueryAliasSelectForm"/>

    <!-- ChangeResults form bean -->
    <form-bean      name="changeResultsForm"
                    type="org.flymine.web.results.ChangeResultsForm"/>

    <!-- run query has no properties, uses an DynaActionForm -->
    <form-bean      name="runQueryForm"
                    type="org.apache.struts.action.DynaActionForm"/>

    <!-- restart query -->
    <form-bean      name="restartQueryForm"
                    type="org.flymine.web.RestartQueryForm"/>

    <!-- save query -->
    <form-bean      name="saveQueryForm"
                    type="org.flymine.web.SaveQueryForm"/>
  </form-beans>

  <!-- ========== Exceptions Configuration ================================ -->

  <global-exceptions>
    <exception type="java.lang.Exception"
               key="exception.message"
               path="error.page"
               handler="org.flymine.web.FlyMineExceptionHandler"/>
  </global-exceptions>

  <!-- ========== Global Forward Definitions ============================== -->

  <global-forwards>
    <forward   name="error"              path="error.page"/>
  </global-forwards>

  <!-- ========== Action Mapping Definitions ============================== -->
  <action-mappings>

    <!-- Input a query -->
    <action path="/query"
                   type="org.flymine.web.QueryBuildAction"
                   name="queryBuildForm"
                   parameter="action">
      <forward name="buildquery" path="query.page"/>
    </action>

    <!-- Input an fql query -->
    <action    path="/fqlquery"
               type="org.flymine.web.FqlQueryAction"
               name="fqlQueryForm"
              scope="request"
              input="query"
              parameter="action">
      <forward name="runquery"              path="/runQuery.do"/>
      <forward name="buildquery"           path="query.page"/>
    </action>

    <!-- Select a QueryClass -->
    <action    path="/queryClassSelect"
               type="org.flymine.web.QueryClassSelectAction"
               name="queryClassSelectForm"
              scope="request"
              input="query"
              parameter="action">
      <forward name="buildquery"           path="query.page"/>
    </action>

    <!-- Select alias of class already in query -->
    <action    path="/queryAliasSelect"
               type="org.flymine.web.QueryAliasSelectAction"
               name="queryAliasSelectForm"
              scope="request"
              input="query"
              parameter="action">
      <forward name="buildquery"           path="query.page"/>
    </action>

    <action    path="/buildquery"
            forward="query.page">
    </action>

    <!-- Action to run a query for a Query object on the session -->
    <action    path="/runQuery"
               type="org.flymine.web.RunQueryAction"
               name="runQueryForm">
      <forward name="results" path="results.page"/>
    </action>

    <!-- Action to reset the current query -->
    <action    path="/restartQuery"
               type="org.flymine.web.RestartQueryAction"
               name="restartQueryForm">
      <forward name="buildquery" path="query.page"/>
    </action>

    <!-- Action to save the current query -->
    <action    path="/saveQuery"
               type="org.flymine.web.SaveQueryAction"
               name="saveQueryForm">
      <forward name="buildquery" path="query.page"/>
    </action>

    <!-- Action to chnge the displayed results in some way -->
    <action    path="/changeResults"
               type="org.flymine.web.results.ChangeResultsAction"
               parameter="method">
      <forward name="runquery" path="/runQuery.do"/>
      <forward name="results" path="results.page"/>
      <forward name="details" path="details.page"/>
    </action>

    <!-- Action to chnge the displayed results in some way -->
    <action    path="/changeResultsSize"
               type="org.flymine.web.results.ChangeResultsSizeAction"
               name="changeResultsForm"
               parameter="action">
      <forward name="results" path="results.page"/>
    </action>

    <action    path="/documentation"
            forward="documentation.page">
    </action>

    <action path="/initQuery" type="org.flymine.web.QueryController"/> 

    <action path="/initQueryBuild" type="org.flymine.web.QueryBuildController"
            name="queryBuildForm"> 
    </action>

    <action path="/initQueryView" type="org.flymine.web.QueryViewController"/>

    <action path="/initResultsView" type="org.flymine.web.results.ResultsViewController">
    </action>

    <action path="/initResultsCell" type="org.flymine.web.results.ResultsCellController">
    </action>

    <action path="/initObjectDetails" type="org.flymine.web.results.ObjectDetailsController">
    </action>

    <!-- don't (re)move this - it's used for importing any model-specific actions -->
    <!--@MODEL_INCLUDE@-->

  </action-mappings>

  <!-- ========== Controller Configuration ================================ -->

  <controller>
    <!-- The "input" parameter on "action" elements is the name of a
         local or global "forward" rather than a module-relative path -->
    <set-property property="inputForward" value="true"/>
  </controller>

  <!-- ========== Message Resources Definitions =========================== -->

  <message-resources parameter="FlyMineWebApp"/>

  <!-- model-specific resources -->
  <message-resources parameter="model" key="model"/>

  <!-- ========== Plug Ins Configuration ================================== -->

  <plug-in className="org.apache.struts.plugins.ModuleConfigVerifier"/>
  <plug-in className="org.flymine.web.InitialiserPlugin"/>

  <plug-in className="org.apache.struts.validator.ValidatorPlugIn">
    <set-property property="pathnames"
                     value="/WEB-INF/validator-rules.xml,
                            /WEB-INF/validation.xml"/>
  </plug-in>

  <plug-in 
    className="org.apache.struts.tiles.TilesPlugin">
    <set-property 
        property="definitions-config" 
        value="/WEB-INF/tiles-defs.xml,/WEB-INF/tiles-defs-model.xml"/>
  </plug-in>

</struts-config>
